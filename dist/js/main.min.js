"use strict";var Search=function(){function e(){var e,t,n;for(e=document.getElementById("search").value.toUpperCase(),n=document.getElementById("result").getElementsByTagName("div"),t=0;t<n.length;t++)-1<(n[t].textContent||n[t].innerText).split("∟")[0].toUpperCase().indexOf(e)?n[t].style.display="":n[t].style.display="none"}return{init:function(){!function(){var e=document.querySelectorAll(".modal-wrapper select")[0],t=document.createElement("input");t.id="search",t.placeholder="Поиск импульса...",e.insertAdjacentHTML("afterEnd",t.outerHTML)}(),document.getElementById("search").addEventListener("input",e)}}},Popup=function(){var n,a,r,e,i={button:"#modal",maxWidth:850,minWidth:280,className:"fade-and-drop"},t=(e=document.createElement("div")).style.WebkitTransition?"webkitTransitionEnd":e.style.OTransition?"oTransitionEnd":"transitionend";function c(){n.className=n.className.replace(" scotch-open",""),r.className=r.className.replace(" scotch-open",""),n.addEventListener(t,function(){n.parentNode.removeChild(n)}),r.addEventListener(t,function(){r.parentNode&&r.parentNode.removeChild(r)})}function o(){(function(e){return document.querySelectorAll(e)[0]})(i.button).addEventListener("click",d)}function l(){var e,t;t=document.createDocumentFragment(),(n=document.createElement("div")).className="scotch-modal "+i.className,n.style.minWidth=i.minWidth+"px",n.style.maxWidth=i.maxWidth+"px",(a=document.createElement("button")).className="scotch-close close-button",a.innerHTML="&times;",n.appendChild(a),(r=document.createElement("div")).className="scotch-overlay "+i.className,t.appendChild(r),(e=document.createElement("div")).className="scotch-content",e.appendChild(function(){var e=document.createDocumentFragment(),t=document.createElement("div");t.className="modal-wrapper";var n=document.createElement("h4");n.innerText=i.title,t.appendChild(n);var a=document.createElement("p");a.innerHTML=i.content,t.appendChild(a);var r=document.createElement("select");r.disabled=!0;var c=document.createElement("option");c.innerText="Загрузка станций...",c.value="0",r.appendChild(c),t.appendChild(r);var o=document.createElement("div");o.id="result",t.appendChild(o);var l=document.createRange().createContextualFragment('<div class="check"><input type="checkbox" name="extend">Расширенный вид</div>');return t.appendChild(l),e.appendChild(t),e}()),n.appendChild(e),t.appendChild(n),document.body.appendChild(t)}function d(){l(),window.App.search.init(),a.addEventListener("click",c),r.addEventListener("click",c),window.getComputedStyle(n).height,n.className=n.className+(n.offsetHeight>window.innerHeight?" scotch-open scotch-anchored":" scotch-open"),r.className=r.className+" scotch-open",window.App.select.createElement()}return{init:function(e){i=function(e){for(var t=1;t<arguments.length;t++)for(var n in arguments[t])arguments[t].hasOwnProperty(n)&&(e[n]=arguments[t][n]);return e}({},i,e),o()}}},Select=function(){var r=["20000","10000","10001","40001","40002","90000","90001"];function a(e,t){var n=new XMLHttpRequest;n.open("GET",e.url+"?table="+e.table+"&param="+e.param),n.send(null),n.onreadystatechange=function(){4===n.readyState&&200===n.status&&t.apply(n)}}return{createElement:function(){a({url:"php/getData.php",table:"kp",param:""},function(e){var t=JSON.parse(this.responseText);t.hasOwnProperty("error")&&alert(t.error);var n=document.querySelectorAll("select")[0];n.disabled=!1,n.options[0].text="Выберите станцию",t.forEach(function(e){var t=document.createElement("option");t.value=e.id,t.innerText=e.sign,n.appendChild(t)}),n.addEventListener("change",function(e){document.querySelectorAll("#result")[0].innerHTML="Загрузка импульсов...",document.getElementById("search").value="",a({url:"php/getData.php",table:"ts",param:e.target.value},function(e){var t=JSON.parse(this.responseText);t.hasOwnProperty("error")&&alert(t.error),t=function(e){var t=JSON.parse(JSON.stringify(e)),n=t.length;console.log(n);for(var a=0;a<n;a++)r.includes(t[a].mnemo_id)?t[a].place="Участок":t[a].place="Станция";return console.log(e),console.log(t),t}(t);var a=document.querySelectorAll("#result")[0];a.innerHTML="",t.forEach(function(e){var t=document.createElement("div"),n="1"==e.dev_desc?"Нет":"Есть";t.innerHTML=e.sign+" - "+n,t.innerHTML+='<span class="info" style="display: '.concat(document.querySelector("input[name=extend]").checked?"block":"none",';">&angrt; id: ').concat(e.val_id,", ip: ").concat(e.interface,", id_shem: ").concat(e.id_shem,", id_mnemo: ").concat(e.mnemo_id,", signal: ").concat(e.dev_desc,", ").concat(e.place,"</span>"),"0"==e.dev_desc&&(t.className="alarm"),null!==e.title&&t.setAttribute("title",e.title),a.appendChild(t)}),function(){var e=document.querySelectorAll("input[name=extend]")[0],s=document.getElementsByClassName("info");console.log(e),e.addEventListener("change",function(){if(this.checked){var e=!0,t=!1,n=void 0;try{for(var a,r=s[Symbol.iterator]();!(e=(a=r.next()).done);e=!0){a.value.style.display="block"}}catch(e){t=!0,n=e}finally{try{e||null==r.return||r.return()}finally{if(t)throw n}}}else{var c=!0,o=!1,l=void 0;try{for(var i,d=s[Symbol.iterator]();!(c=(i=d.next()).done);c=!0){i.value.style.display="none"}}catch(e){o=!0,l=e}finally{try{c||null==d.return||d.return()}finally{if(o)throw l}}}})}()})})})}}};window.App={},window.App.popup=Popup(),window.App.select=Select(),window.App.search=Search(),window.App.popup.init({button:"#modal-button",title:"Импульсы ТС",content:"<b>Есть</b> сигнализация, <b>Нет</b> сигнализации."});